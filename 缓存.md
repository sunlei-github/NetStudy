[Toc]

### 缓存的作用

1. 提高系统性能，减少请求次数
2. 分担系统压力，使系统更加稳定

### 请求缓存图示

![1615013552517](D:\学习\vsProject\Study\NetStudy\1615013552517.png)

浏览获取一个域名之后在在本地（客户端查询）是否有对应的数据，如果有直接并且数据没有过期，那么直接返回，反之向CDN发起请求，CDN会搜索是否以后对应的缓存数据，如果有并且没有过期则直接返回，反之则向DNS发起请求，DNS解析域名后，然后根据解析到的IP去请求对应的服务器获取数据，如果请求的服务器的反向代理缓存了对应的数据，则返回，反之则向服务器发起请求，逐层返回的时候，会以次更新每层的缓存数据。

#### CDN缓存

![](D:\学习\vsProject\Study\NetStudy\1615014215665.png)

>  一、CDN是什么？
>
>   http缓存是浏览器端缓存，cdn是服务器端缓存。
>
>​     举个例子来说明cdn的作用：cdn就是代理。厂家给商家发货，你从商家买货，商家就是cdn，很方便。
>
>二、CDN怎么缓存？
>
>​     和Http类似，客户端请求数据时，先从本地缓存查找，如果被请求数据没有过期，拿过来用，如果过期，就向CDN边缘节点发起请求。CDN便会检测被请求的数据是否过期，如果没有过期，就返回数据给客户端，如果过期，CDN再向源站发送请求获取新数据。和买家买货，卖家没货，卖家再进货一个道理。
>
> CDN边缘节点缓存机制，一般都遵守http标准协议，通过http响应头中的Cache-Control和max-age的字段来设置CDN边缘节点的数据缓存时间。 

#### 客户端缓存

![1615014794656](D:\学习\vsProject\Study\NetStudy\1615014794656.png)

服务器返回给客户端的某些请求数据，并且服务器指定这些返回的数据需要客户端缓存起来，那么客户端便会将该次返回的信息缓存到本地，这些缓存的基本信息都可以在请求的响应头中查看。

![1615014743172](D:\学习\vsProject\Study\NetStudy\1615014743172.png)

**客户端缓存只会影响使用该浏览器的用户。**

**缓存协商**

![1615015052423](D:\学习\vsProject\Study\NetStudy\1615015052423.png)

缓存协商的主要目的是为了即使更新缓存，保证返回数据的正确性，可以通过Etag或者Last-Modified的方式进行缓存更新。

### 反向代理缓存

![1615015228273](D:\学习\vsProject\Study\NetStudy\1615015228273.png)

> 反向代理 （nginx）
>
> 大家都有过这样的经历，拨打10086客服电话，可能一个地区的10086客服有几个或者几十个，你永远都不需要关心在电话那头的是哪一个，叫什么，男的，还是女的，漂亮的还是帅气的，你都不关心，你关心的是你的问题能不能得到专业的解答，你只需要拨通了10086的总机号码，电话那头总会有人会回答你，只是有时慢有时快而已。那么这里的10086总机号码就是我们说的反向代理客户不知道真正提供服务人的是谁
>
> 反向代理隐藏了真实的服务端，当我们请求 www.baidu.com 的时候，就像拨打10086一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了www.baidu.com 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。Nginx就是性能非常好的反向代理服务器，用来做负载均衡。
>
> 反向代理的优点
>
> 1.隔离网络，保护服务器(节约公共IP)
>
> 2.网络加速，反向代理双网卡
>
> 3.负载均衡
>
> 4.缓存(跟CDN，也是识别一下header，压缩到一个物理路径/内存)

**反向代理缓存会影响所有使用该服务器的用户。**